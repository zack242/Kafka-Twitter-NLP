<html>
   <head>
      <title>Dashboard</title>
      <link rel="stylesheet" href="style.css">
   </head>
   <body>
      <h1>Twitter NLP</h1>
      <div class="container">
         <!-- Add some cards to the dashboard -->
         <div class="card">
            <h2>Keyword to stream</h2>
            <br>
            <p class="stats">
               <input id="keyword" type="text">
               <button id="send">SEND</button>
            </p>
            <p class="description">Current keyword : "COVID</p>
         </div>
         <div class="card">
            <h2>Number of Tweets</h2>
            <p class="stats" id="tweet-count"></p>
         </div>
         <div class="card">
            <h2>Dynamic CloudWord</h2>
            <div id="pic"></div>
         </div>
         <div class="card">
            <h2>Stream of tweets </h2>
            <div id="fil-tweets"></div>
         </div>
      </div>
   </body>
   <script src="/socket.io/socket.io.js"></script>
   <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
   <script>
      $(function () {
      
        var arr_tweets = [];
        var socket = io();
        loadImage()
      
        setInterval(function() {
          fetch('/nbrTweets')
            .then(response => response.json())
            .then(data => {
              document.querySelector('#tweet-count').textContent = data.nbrTweets;
            });
        }, 1000);
      
        function loadImage() {
          fetch("/image")
          .then(response => response.text())
          .then(data => {
            document.getElementById('pic').innerHTML = data;})
        .catch(error => {
        console.error(error);});
        }
      
        function showtweets(tweets) 
        {
          arr_tweets.push(tweets)
          if(arr_tweets.length > 20)
              arr_tweets.shift()
          
          $('#fil-tweets').empty();
          arr_tweets.forEach(tweet => {
              $("#fil-tweets").prepend("<div id='tweet'>" + tweet + "</div>");
          });
        }
      
        $('#send').click(function() {
          key = $('#keyword').val()
          fetch(`/keyword?key=${key}`, {
            method: 'GET'
          })
          .then(res => res.json())
          .then(response => console.log('Success:', response))
          .catch(error => console.error('Error:', error));
        });
        
      
        socket.on('message', function(msg) {
          if (msg=="go")
               loadImage()
          else {
              const obj = JSON.parse(msg);
              showtweets(obj.text) 
          }
        });
      
      });
      
   </script>
</html>